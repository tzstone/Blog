# 正则表达式拾遗

## 基础

- 多选结构可以包括很多字符, 但不能超越括号的界限(如`gr(a|e)y`).
- 括号的作用
  - 限制多选结构的范围
  - 将若干字符组合为一个单元, 受`?`、`*`、`+`等量词的作用
  - 反向引用. `\1` `\2`表示第一, 第二组括号匹配的文本, 括号是按照开括号`(`从左到右的出现顺序进行的.
    - `(?:exp)`匹配exp, 不捕获匹配的文本, 也不给此分组分配组号. 避免了不必要的捕获操作, 提高了匹配效率.
- "子表达式"指的是整个正则表达式中的一部分, 通常是括号内的表达式, 或者是由`|`分隔的多选分支. 严格来讲, 字符也可以是子表达式, 如`cat`中`c`、`a`、`t`都算子表达式.
- 转义的3种情况
  - `\`加上元字符, 表示匹配元字符所使用的普通字符(如`\*`匹配普通的星号)
  - `\`加上非元字符, 组成一种由具体实现方式规定其意义的元字符序列(如egrep中`\<`表示单词的起始边界)
  - `\`加上任意其他字符, 默认情况就是匹配此字符(反斜杠被忽略了)

## 元字符

- `^`匹配字符串的开始, `$`匹配字符串的结尾.
- `.` 匹配除换行符以外的任意字符
- `\s`表示所有"空白字符"的字符组, 包括空格符, 制表符, 换行符, 回车符等.
- `\w`匹配 `[a-zA-Z0-9_]`
- `\W`匹配`[^a-zA-Z0-9_]`
- `?`代表可选项. 把它加在一个字符的后面, 就表示此处容许出现这个字符, 不过它的出现并非匹配成功的必要条件. `?`只作用于之前紧邻的元素.
- `+` 表示之前紧邻的元素出现一次或多次.
- `*` 表示之前紧邻的元素出现任意多次, 或者不出现.
  - `? + *` 统称为量词, 它们限定了所作用元素的匹配次数. 量词作用的对象是它们之前紧邻的子表达式.
  - 一个字符组是一个"单元(unit)", 所以它后面可以加量词, 如`[0-9]+`
  - // TODO: 两个量词在一起的匹配过程是怎样的, 如`11+?`
- `\b`单词分界符. 匹配一个位置, 该位置的一侧是单词, 另一侧不是单词. 单词是指`\w`, 即字母, 数字, 下划线.

## 字符组

- 一个字符组, 即使是排除型字符组, 也需要匹配一个字符.
- `[...]` 字符组匹配单个列出的字符.
- `[^...]` 排除型字符组表示”匹配一个未列出的字符”, 而不是”不要匹配列出的字符”. 脱字符`^`仅作为字符组内部第一个字符时才是元字符, 在其他位置则表示普通字符.
- `-`连字符是字符组的元字符, 表示一个范围, 如`[0-9]`表示匹配数字0到9. 连字符作为字符组的第一个或最后一个字符时表示普通字符'-', 如`[-0]`表示匹配字符'-'和数字0. 使用连字符表示范围时, 一般是根据字符所对应的ASCII码值大小所定, 码值小的在前, 码值大的在后, 否则是非法的, 如`[z-a]`是非法的.
- 字符组中`-`连字符是元字符, 其他元字符`.(?`等则表示普通字符, 如果要保留其特殊含义, 需要加反斜杠`\`进行转义, 如`[.]`匹配普通字符'.', `[\.]`则匹配任意字符(不同实现可能不一样).
- 字符组"子语言"的规范不同于正则表达式主体.

## 修饰符

- `/g` 全局匹配, 第一次匹配成功后继续搜索其他匹配项, 直至找到所有匹配.
- `/m`

## 环视(lookaround)

- 环视结构不匹配任何字符, 只匹配文本中的特定位置. 环视不会消耗字符.
- 环视不会匹配字符, 但环视中的分组仍然会被捕获. 如`(?=(\d{3})+(?!\d))`中会捕获`(\d{3})`
- 顺序环视顺序(从左至右)查看文本, 尝试匹配子表达式, 如果能够匹配, 就返回匹配成功信息.
  - `(?=exp)` 肯定型顺序环视, 表示如果当前位置右边的字符能匹配`exp`则匹配成功
  - `(?!exp)` 否定型顺序环视, `exp`不能匹配右侧文本
- 逆序环视逆序(从右向左)查看文本, 尝试匹配子表达式, 如果能够匹配, 就返回匹配成功信息.
  - `(?<=exp)` 肯定型逆序环视, 表示如果当前位置左边的字符能匹配`exp`则匹配成功
  - `(?<!exp)` 否定型逆序环视, `exp`不能匹配左侧文本
